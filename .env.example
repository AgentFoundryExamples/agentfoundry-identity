# ============================================================
# Agent Foundry Identity Service - Environment Configuration
# ============================================================
# Copy this file to .env and fill in the required values.
# Required variables are marked with [REQUIRED].
# Optional variables have default values shown.
#
# PRODUCTION NOTE: For production deployments, use Google Secret Manager
# to store sensitive values. Reference secrets in Cloud Run with:
#   --set-secrets="VARIABLE_NAME=secret-name:latest"
#
# See docs/identity/deployment.md for complete production setup.
# ============================================================

# ============================================================
# ENVIRONMENT MODE
# ============================================================

# Environment mode controls which backends are used.
# Options: dev, prod
# Default: dev
#
# 'dev' mode:
#   - Uses in-memory stub implementations (DATA LOST ON RESTART)
#   - No external dependencies required (Postgres, Redis)
#   - Suitable for local development and testing ONLY
#   - WARNING: Never use in production!
#
# 'prod' mode:
#   - Requires Postgres and Redis configuration below
#   - Uses encrypted Postgres for tokens, Redis for sessions
#   - Fails to start if backends are not configured
#   - Run migrations before first start: python -m af_identity_service.migrations migrate
IDENTITY_ENVIRONMENT=dev

# ============================================================
# REQUIRED SECRETS
# ============================================================
# PRODUCTION: Store these in Secret Manager, not environment variables!
#   gcloud secrets create identity-jwt-secret --data-file=-
#   gcloud run deploy --set-secrets="IDENTITY_JWT_SECRET=identity-jwt-secret:latest"
# ============================================================

# [REQUIRED] Secret key for signing JWT tokens.
# Must be at least 32 characters long.
# Generate with: openssl rand -base64 32
# SECRET MANAGER: identity-jwt-secret
# WARNING: Replace this placeholder before use - never deploy with example values!
IDENTITY_JWT_SECRET=CHANGE_ME_generate_with_openssl_rand_base64_32

# [REQUIRED] GitHub OAuth App client ID.
# Create an OAuth App at https://github.com/settings/developers
# SECRET MANAGER: github-client-id
GITHUB_CLIENT_ID=your-github-client-id

# [REQUIRED] GitHub OAuth App client secret.
# From your GitHub OAuth App settings.
# SECRET MANAGER: github-client-secret
GITHUB_CLIENT_SECRET=your-github-client-secret

# ============================================================
# TOKEN ENCRYPTION (Required in prod mode)
# ============================================================
# GitHub tokens are encrypted at rest using AES-256-GCM.
# Generate a 256-bit key: python -c "import secrets; print(secrets.token_hex(32))"
# SECRET MANAGER: github-token-enc-key
# ============================================================

# [REQUIRED IN PROD] 256-bit AES encryption key (64 hex characters).
# Used to encrypt GitHub OAuth tokens at rest in PostgreSQL.
# Never reuse keys between environments!
# 
# To validate key format before deployment:
#   python -c "import binascii; binascii.unhexlify('YOUR_KEY_HERE')" 
# A valid key will produce no output; invalid keys will raise an error.
#
# GITHUB_TOKEN_ENC_KEY=CHANGE_ME_generate_with_python_secrets_token_hex_32

# [OPTIONAL] Previous encryption key for key rotation.
# Set this to the old key when rotating to a new key.
# Old tokens can still be decrypted during the rotation period.
# Remove after all tokens have been re-encrypted.
# GITHUB_TOKEN_ENC_KEY_OLD=previous-64-hex-character-key

# ============================================================
# POSTGRES CONFIGURATION (Required in prod mode)
# ============================================================
# Production requires encrypted PostgreSQL (Cloud SQL with SSL).
# See docs/identity/deployment.md for Cloud SQL setup.
# ============================================================

# Postgres host address.
# Required in prod mode unless using GOOGLE_CLOUD_SQL_INSTANCE.
# For Cloud Run: /cloudsql/project:region:instance
# POSTGRES_HOST=localhost

# Postgres port number.
# Default: 5432
# POSTGRES_PORT=5432

# Postgres database name.
# Required in prod mode when POSTGRES_HOST is set.
# POSTGRES_DB=identity_service

# Postgres username.
# Required in prod mode when POSTGRES_HOST is set.
# POSTGRES_USER=identity_user

# Postgres password.
# Required in prod mode when POSTGRES_HOST is set.
# [SENSITIVE] Never commit actual passwords to version control.
# SECRET MANAGER: postgres-password
# POSTGRES_PASSWORD=your-postgres-password

# Google Cloud SQL instance connection name.
# Format: project:region:instance
# Alternative to POSTGRES_HOST for Cloud Run deployments.
# When set, use POSTGRES_HOST=/cloudsql/project:region:instance
# GOOGLE_CLOUD_SQL_INSTANCE=my-project:us-central1:my-instance

# ============================================================
# REDIS CONFIGURATION (Required in prod mode)
# ============================================================
# Production requires Redis with TLS (Cloud MemoryStore).
# Sessions and OAuth state are stored in Redis.
# See docs/identity/deployment.md for MemoryStore setup.
# ============================================================

# Redis host address.
# Required in prod mode.
# Use the private IP from MemoryStore for Cloud Run.
# REDIS_HOST=localhost

# Redis port number.
# Default: 6379
# REDIS_PORT=6379

# Redis database number.
# Default: 0
# Range: 0 to 15
# REDIS_DB=0

# Enable TLS for Redis connections.
# Default: false
# Set to true when using Redis with TLS (e.g., Cloud Memorystore).
# REQUIRED for production!
# REDIS_TLS_ENABLED=false

# ============================================================
# OAUTH CONFIGURATION
# ============================================================

# Comma-separated list of GitHub OAuth scopes to request.
# Default: read:user,user:email
# See: https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps
OAUTH_SCOPES=read:user,user:email

# ============================================================
# JWT AND SESSION CONFIGURATION
# ============================================================

# JWT token expiry time in seconds.
# Default: 3600 (1 hour)
# Range: 60 to 86400 seconds
JWT_EXPIRY_SECONDS=3600

# Session expiry time in seconds.
# Default: 86400 (24 hours)
# Range: 300 to 604800 seconds (5 minutes to 7 days)
SESSION_EXPIRY_SECONDS=86400

# ============================================================
# ADMIN CONFIGURATION
# ============================================================

# Comma-separated list of GitHub user IDs with admin access.
# Leave empty for no admin users.
# Find your GitHub ID at: https://api.github.com/users/YOUR_USERNAME
ADMIN_GITHUB_IDS=

# Enable admin debugging endpoints (session listing).
# Default: false
# Set to true to enable /v1/admin/* endpoints.
# SECURITY: Only enable in trusted environments.
ADMIN_TOOLS_ENABLED=false

# ============================================================
# LOGGING CONFIGURATION
# ============================================================

# Logging level for the service.
# Options: DEBUG, INFO, WARNING, ERROR, CRITICAL
# Default: INFO
LOG_LEVEL=INFO

# Log output format.
# Options: json, console
# Default: json (recommended for production)
# Use 'console' for local development for colored output.
LOG_FORMAT=json

# ============================================================
# SERVICE CONFIGURATION
# ============================================================

# Host to bind the service to.
# Default: 0.0.0.0 (all interfaces)
# For local development, you might use 127.0.0.1
SERVICE_HOST=0.0.0.0

# Port to bind the service to.
# Default: 8080 (Cloud Run default)
# Range: 1 to 65535
SERVICE_PORT=8080
